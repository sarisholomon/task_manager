{% extends 'base.html' %}

{% block content %}
<div class="max-w-5xl mx-auto">

    <div class="flex flex-col md:flex-row justify-between items-center mb-8 bg-app-card p-6 rounded-2xl shadow-lg border border-white/5 relative overflow-hidden">
        <div class="absolute top-0 right-0 w-32 h-32 bg-neon-purple/10 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"></div>

        <div class="relative z-10">
            <h1 class="text-3xl font-bold text-white mb-2 flex items-center gap-3">
                <span class="p-2 bg-neon-purple/20 rounded-lg border border-neon-purple/50">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 text-neon-purple">
                        <path fill-rule="evenodd" d="M3 6a3 3 0 013-3h2.25a3 3 0 013 3v2.25a3 3 0 01-3 3H6a3 3 0 01-3-3V6zm9.75 0a3 3 0 013-3H18a3 3 0 013 3v2.25a3 3 0 01-3 3h-2.25a3 3 0 01-3-3V6zM3 15.75a3 3 0 013-3h2.25a3 3 0 013 3V18a3 3 0 01-3 3H6a3 3 0 01-3-3v-2.25zm9.75 0a3 3 0 013-3H18a3 3 0 013 3V18a3 3 0 01-3 3h-2.25a3 3 0 01-3-3v-2.25z" clip-rule="evenodd" />
                    </svg>
                </span>
                ניהול משימות <span class="text-neon-purple text-lg font-normal">| צוות {{ profile.team.Name }}</span>
            </h1>
        <div class="flex items-center gap-4 mt-2">
    <p class="text-gray-400">
        שלום, <strong class="text-white">{{ request.user.username }}</strong>
        <span class="px-2 py-0.5 rounded text-xs border border-gray-600 ml-2 bg-gray-800">
            {% if profile.role == 'admin' %}מנהל מערכת{% else %}עובד צוות{% endif %}
        </span>
    </p>

    <a href="{% url 'logout' %}" class="px-3 py-1 rounded-lg bg-red-500/10 text-red-400 border border-red-500/30 hover:bg-red-500 hover:text-white transition-all text-xs font-bold flex items-center gap-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-3 h-3">
            <path fill-rule="evenodd" d="M3 4.25A2.25 2.25 0 015.25 2h5.5A2.25 2.25 0 0113 4.25v2a.75.75 0 01-1.5 0v-2a.75.75 0 00-.75-.75h-5.5a.75.75 0 00-.75.75v11.5c0 .414.336.75.75.75h5.5a.75.75 0 00.75-.75v-2a.75.75 0 011.5 0v2A2.25 2.25 0 0110.75 18h-5.5A2.25 2.25 0 013 15.75V4.25z" clip-rule="evenodd" />
            <path fill-rule="evenodd" d="M19 10a.75.75 0 00-.75-.75H8.704l1.048-.943a.75.75 0 10-1.004-1.114l-2.5 2.25a.75.75 0 000 1.114l2.5 2.25a.75.75 0 101.004-1.114l-1.048-.943h9.546A.75.75 0 0019 10z" clip-rule="evenodd" />
        </svg>
        התנתק
    </a>
</div>
        </div>

        {% if profile.role == 'admin' %}
            <a href="{% url 'create' %}" class="mt-6 md:mt-0 bg-neon-purple hover:bg-neon-hover text-white font-bold py-3 px-6 rounded-xl shadow-[0_0_15px_rgba(99,102,241,0.5)] transition-all transform hover:scale-105 flex items-center gap-2 relative z-10">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
                    <path fill-rule="evenodd" d="M12 3.75a.75.75 0 01.75.75v6.75h6.75a.75.75 0 010 1.5h-6.75v6.75a.75.75 0 01-1.5 0v-6.75H4.5a.75.75 0 010-1.5h6.75V4.5a.75.75 0 01.75-.75z" clip-rule="evenodd" />
                </svg>
                משימה חדשה
            </a>
        {% endif %}
    </div>

    <div class="mb-8 p-4 bg-app-card/50 rounded-xl border border-white/5 backdrop-blur-sm shadow-md">
        <form method="get" class="flex flex-wrap items-center gap-6">

            <div class="flex items-center gap-3">
                <label class="text-gray-400 font-medium">סנן לפי סטטוס:</label>
                <div class="relative">
                    <select name="status" onchange="this.form.submit()"
                            class="appearance-none bg-app-input text-white border border-gray-600 rounded-lg pl-4 pr-10 py-2 focus:outline-none focus:border-neon-purple focus:ring-1 focus:ring-neon-purple transition-colors cursor-pointer min-w-[140px]">
                        <option value="">הצג הכל</option>
                        <option value="new" {% if current_status == 'new' %}selected{% endif %}>חדש</option>
                        <option value="in progress" {% if current_status == 'in progress' %}selected{% endif %}>בתהליך</option>
                        <option value="completed" {% if current_status == 'completed' %}selected{% endif %}>הושלם</option>
                    </select>
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                        </svg>
                    </div>
                </div>
            </div>

            {% if profile.role == 'user' %}
                <label class="flex items-center gap-3 cursor-pointer group bg-app-input/30 px-4 py-2 rounded-lg border border-transparent hover:border-gray-600 transition-all">
                    <div class="relative">
                        <input type="checkbox" name="mine" value="true" onchange="this.form.submit()"
                               {% if current_mine == 'true' %}checked{% endif %}
                               class="peer sr-only">
                        <div class="w-9 h-5 bg-gray-600 rounded-full peer-checked:bg-neon-purple transition-all"></div>
                        <div class="absolute top-1 right-1 bg-white w-3 h-3 rounded-full transition-all peer-checked:bg-white peer-checked:right-5"></div>
                    </div>
                    <span class="text-gray-300 group-hover:text-white transition-colors text-sm font-medium">הצג רק משימות שלי</span>
                </label>
            {% endif %}

            <a href="{% url 'task_list' %}" class="mr-auto text-sm text-gray-500 hover:text-white transition-colors border-b border-transparent hover:border-gray-500 flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                    <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
                </svg>
                נקה סינון
            </a>
        </form>
    </div>

    <div class="space-y-4">
        {% for task in tasks %}
            <div class="bg-app-card p-5 rounded-xl border border-white/5 hover:border-neon-purple/30 transition-all shadow-md flex flex-col md:flex-row justify-between items-center gap-4 group hover:bg-app-card/80">

                <div class="flex-1 w-full">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-xl font-bold text-white group-hover:text-neon-purple transition-colors">{{ task.name }}</h3>

                        <span class="px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider shadow-sm
                            {% if task.myStatus == 'new' %}bg-blue-500/10 text-blue-400 border border-blue-500/30
                            {% elif task.myStatus == 'in progress' %}bg-yellow-500/10 text-yellow-400 border border-yellow-500/30
                            {% else %}bg-green-500/10 text-green-400 border border-green-500/30{% endif %}">
                            {{ task.myStatus }}
                        </span>
                    </div>

                    <div class="flex items-center gap-6 text-sm text-gray-400 mt-3">
                        <span class="flex items-center gap-2 bg-gray-800/50 px-3 py-1 rounded-md">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                                <path fill-rule="evenodd" d="M5.75 2a.75.75 0 01.75.75V4h7V2.75a.75.75 0 011.5 0V4h.25A2.75 2.75 0 0118 6.75v8.5A2.75 2.75 0 0115.25 18H4.75A2.75 2.75 0 012 15.25v-8.5A2.75 2.75 0 014.75 4H5V2.75A.75.75 0 015.75 2zm-1 5.5c-.69 0-1.25.56-1.25 1.25v6.5c0 .69.56 1.25 1.25 1.25h10.5c.69 0 1.25-.56 1.25-1.25v-6.5c0-.69-.56-1.25-1.25-1.25H4.75z" clip-rule="evenodd" />
                            </svg>
                            {{ task.date }}
                        </span>
                        <span class="flex items-center gap-2 bg-gray-800/50 px-3 py-1 rounded-md">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                                <path d="M10 8a3 3 0 100-6 3 3 0 000 6zM3.465 14.493a1.23 1.23 0 00.41 1.412A9.957 9.957 0 0010 18c2.31 0 4.438-.784 6.131-2.1.43-.333.604-.903.408-1.41a7.002 7.002 0 00-13.074.003z" />
                            </svg>
                            {% if task.AssignedUser %}
                                <span class="text-neon-purple font-medium">{{ task.AssignedUser.username }}</span>
                            {% else %}
                                <span class="text-gray-600 italic">לא משויך</span>
                            {% endif %}
                        </span>
                    </div>
                </div>

                <div class="flex items-center gap-3 w-full md:w-auto justify-end border-t md:border-t-0 border-white/5 pt-4 md:pt-0 mt-2 md:mt-0">

                    {% if profile.role == 'admin' and not task.AssignedUser %}
                        <a href="{% url 'update' task.id %}" class="p-2.5 rounded-lg bg-gray-700 hover:bg-white hover:text-gray-900 text-gray-300 transition-all shadow-sm" title="עריכה">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                <path d="M5.433 13.917l1.262-3.155A4 4 0 017.58 9.42l6.92-6.918a2.121 2.121 0 013 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 01-.65-.65z" />
                                <path d="M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0010 3H4.75A2.75 2.75 0 002 5.75v9.5A2.75 2.75 0 004.75 18h9.5A2.75 2.75 0 0017 15.25V10a.75.75 0 00-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5z" />
                            </svg>
                        </a>
                        <a href="{% url 'delete' task.id %}" onclick="return confirm('למחוק את המשימה?')" class="p-2.5 rounded-lg bg-red-900/30 hover:bg-red-600 text-red-300 hover:text-white border border-red-900/50 transition-all shadow-sm" title="מחיקה">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                <path fill-rule="evenodd" d="M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.584.176-2.365.298a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.53l.841-10.52.149.023a.75.75 0 00.23-1.482A41.03 41.03 0 0014 4.193V3.75A2.75 2.75 0 0011.25 1h-2.5zM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4zM8.58 7.72a.75.75 0 00-1.5.06l.3 7.5a.75.75 0 101.5-.06l-.3-7.5zm4.34.06a.75.75 0 10-1.5-.06l-.3 7.5a.75.75 0 101.5.06l.3-7.5z" clip-rule="evenodd" />
                            </svg>
                        </a>
                    {% endif %}

                    {% if profile.role == 'user' %}

                        {% if task.myStatus == 'new' %}
                            <a href="{% url 'claim' task.id %}" class="px-5 py-2.5 rounded-lg bg-blue-600/10 text-blue-400 border border-blue-600/30 hover:bg-blue-600 hover:text-white hover:border-blue-500 transition-all font-medium text-sm flex items-center gap-2 shadow-sm">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.75-11.25a.75.75 0 00-1.5 0v2.5h-2.5a.75.75 0 000 1.5h2.5v2.5a.75.75 0 001.5 0v-2.5h2.5a.75.75 0 000-1.5h-2.5v-2.5z" clip-rule="evenodd" />
                                </svg>
                                שייך אליי
                            </a>
                        {% endif %}

                        {% if task.myStatus == 'in progress' and task.AssignedUser == request.user %}
                            <a href="{% url 'complete' task.id %}" class="px-5 py-2.5 rounded-lg bg-green-600/10 text-green-400 border border-green-600/30 hover:bg-green-600 hover:text-white hover:border-green-500 transition-all font-medium text-sm flex items-center gap-2 shadow-sm">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                                    <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z" clip-rule="evenodd" />
                                </svg>
                                סיום משימה
                            </a>
                        {% endif %}

                    {% endif %}
                </div>
            </div>
        {% empty %}
            <div class="text-center py-20 bg-app-card/30 rounded-3xl border border-dashed border-gray-700 flex flex-col items-center justify-center">
                <div class="w-20 h-20 bg-gray-800 rounded-full flex items-center justify-center mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-10 h-10 text-gray-600">
                        <path fill-rule="evenodd" d="M5.625 1.5c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0016.5 9h-1.875a1.875 1.875 0 01-1.875-1.875V5.25A3.75 3.75 0 009 1.5H5.625zM7.5 15a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5A.75.75 0 017.5 15zm.75 2.25a.75.75 0 000 1.5H12a.75.75 0 000-1.5H8.25z" clip-rule="evenodd" />
                        <path d="M12.971 1.816A5.23 5.23 0 0114.25 5.25v1.875c0 .207.168.375.375.375H16.5a5.23 5.23 0 013.434 1.279 9.768 9.768 0 00-6.963-6.963z" />
                    </svg>
                </div>
                <p class="text-gray-400 text-xl font-medium">אין משימות כרגע בצוות</p>
                {% if profile.role == 'admin' %}
                    <p class="text-sm text-gray-500 mt-2">לחץ על כפתור "משימה חדשה" כדי להתחיל</p>
                {% else %}
                    <p class="text-sm text-gray-500 mt-2">המשימות שיווצרו יופיעו כאן</p>
                {% endif %}
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %}